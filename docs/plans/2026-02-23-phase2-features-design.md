# 第二期功能设计文档

## 概述

第二期聚焦于用户体验提升和功能扩展，包括：PWA支持、习惯追踪、快速记录、搜索功能、键盘快捷键和加载优化。

---

## 一、PWA 支持

### 1.1 Service Worker
- 缓存静态资源（JS、CSS、图片）
- 离线时显示离线页面
- 后台同步数据

### 1.2 Web App Manifest
```json
{
  "name": "生活记录",
  "short_name": "记录",
  "theme_color": "#3B82F6",
  "background_color": "#FFFFFF",
  "display": "standalone",
  "icons": [...]
}
```

### 1.3 安装提示
- 首次访问检测是否可安装
- 显示可移除的 banner 或弹窗

---

## 二、习惯追踪

### 2.1 数据模型
```typescript
interface Habit {
  id: string;
  name: string;
  icon: string;
  frequency: 'daily' | 'weekly';
  targetDays: number[]; // 每周目标天数 (1-7)
  createdAt: Date;
}

interface HabitLog {
  id: string;
  habitId: string;
  date: string; // YYYY-MM-DD
  completed: boolean;
}
```

### 2.2 习惯卡片
- 显示：名称、图标、连续天数、今日状态
- 进度条：本周完成率
- 快捷操作：点击打卡

### 2.3 页面结构
```
/habits
├── Header: 统计概览 + 新建按钮
├── HabitGrid: 习惯卡片列表 (2列)
└── Calendar: 月度打卡日历
```

---

## 三、快速记录

### 3.1 呼起方式
- 键盘 `n` 键
- 浮动按钮（FAB 旁边）

### 3.2 面板设计
- 从底部滑出 (bottom sheet)
- 半透明遮罩
- 极简表单：内容 + Tag + 状态

### 3.3 交互流程
1. 按 `n` 或点击快捷按钮
2. 面板滑出，内容输入框自动聚焦
3. 输入内容，选择 Tag 和状态
4. Enter 或点击保存
5. 面板关闭，Toast 提示成功

---

## 四、搜索功能

### 4.1 搜索入口
- FilterBar 中集成搜索输入框
- 键盘 `/` 聚焦搜索

### 4.2 搜索逻辑
- 全文搜索 content 字段
- 支持 Tag 过滤
- 搜索结果高亮关键字

### 4.3 结果展示
- 匹配的内容片段（带高亮）
- 跳转到对应记录

---

## 五、键盘快捷键

### 5.1 快捷键列表
| 按键 | 功能 |
|------|------|
| `n` | 新建记录 |
| `/` | 聚焦搜索 |
| `j` | 下一条记录 |
| `k` | 上一条记录 |
| `Enter` | 编辑选中记录 |
| `Esc` | 关闭弹窗/取消 |

### 5.2 视觉提示
- 底部常驻快捷键提示栏
- `/` 聚焦时显示完整帮助弹窗
- 选中项：蓝色左边框指示

---

## 六、加载优化

### 6.1 骨架屏
- Timeline 加载时显示骨架屏
- 卡片使用渐变 shimmer 动画

### 6.2 图片优化
- 懒加载：Intersection Observer
- blur-up 效果：缩略图 → 原图

### 6.3 分页
- 列表超过 50 条分页加载
- 无限滚动 + 加载更多

---

## UI 设计规范

### 颜色
| 用途 | 色值 |
|------|------|
| 主色 | #3B82F6 |
| 成功 | #10B981 |
| 警告 | #F59E0B |
| 危险 | #EF4444 |
| 背景 | #FFFFFF / #F9FAFB |
| 文字 | #111827 / #6B7280 |

### 间距
- 基准: 4px
- 常用: 8, 12, 16, 24, 32px

### 圆角
- 小: 4px
- 中: 8px
- 大: 12px / 16px

### 过渡
- 默认: 150ms ease-out

---

## 实施优先级

1. **PWA** - 离线可用性基础
2. **键盘快捷键** - 快速提升效率
3. **快速记录** - 降低记录门槛
4. **加载优化** - 改善感知性能
5. **搜索功能** - 信息检索
6. **习惯追踪** - 较大功能模块
