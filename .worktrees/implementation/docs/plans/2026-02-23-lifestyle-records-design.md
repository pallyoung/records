# 日常生活记录工具 - 设计文档

## 项目概述

一个用于记录日常生活片段的 Web 应用，支持文字和图片记录，可通过 Tag 和状态进行多维度筛选，时间线方式展示。

## 核心功能

### 1. 记录管理

- **内容类型**：支持文字和图片两种
- **Tag 系统**：
  - 每个记录可添加多个 Tag
  - 支持手动输入或从已有 Tag 中选择
  - 输入新 Tag 自动保存
- **图片处理**：支持图片上传和预览

### 2. 状态系统

- **三种状态**：未开始、进行中、已完成
- **时间字段**（均为可选）：
  - 计划开始时间：用户填写
  - 计划结束时间：用户填写
  - 实际开始时间：状态切换为"进行中"时自动记录
  - 实际结束时间：状态切换为"已完成"时自动记录
- **默认值**：未填写计划时间时，以实际时间为准
- **状态切换**：由用户手动操作
  - 未开始 → 进行中：记录实际开始时间
  - 进行中 → 已完成：记录实际结束时间
- **风险提示**：
  - 未开始且超计划开始时间：显示警告（红色）
  - 进行中且超计划结束时间：显示警告（红色）
- **时间显示**：
  - 未开始：计划开始时间 - 当前时间 = "XX天后开始"
  - 进行中：计划结束时间 - 当前时间 = "XX天后结束"
  - 已完成：显示"已完成"

### 3. 筛选功能

- **筛选维度**：Tag + 状态
- **筛选逻辑**：AND 组合
- **示例**：Tag=工作 且 状态=进行中

### 4. 时间线展示

- **时间粒度**：按天 / 按周 / 按月，可自由切换
- **排序规则**：同一范围内按时间倒序排列

### 5. 复盘功能

- **入口**：专门的复盘页面
- **默认范围**：当前自然月 + 全部 Tag
- **可自定义**：
  - 时间范围：选择开始月份和结束月份
  - Tag 筛选：可选择特定 Tag
- **复盘信息**：
  - **计划是否延期**（自动计算）：
    - 延期：实际结束时间 > 计划结束时间
    - 按期：实际结束时间 = 计划结束时间（±1天误差）
    - 提前：实际结束时间 < 计划结束时间
  - **计划达成**（用户选择）：
    - 未达预期
    - 达成预期
    - 超出预期
  - **详细信息**：用户填写总结原因

### 6. 数据存储

- **本地存储**：浏览器 IndexedDB
- **接口预留**：数据层抽象，支持未来扩展云端同步

## 技术方案

| 技术栈 | 选择 |
|--------|------|
| 前端框架 | React + TypeScript |
| 状态管理 | @relax-state/react |
| 构建工具 | Vite |
| 本地存储 | IndexedDB (Dexie.js) |
| 部署方式 | 静态网页 + PWA |

## 数据结构

```typescript
interface Record {
  id: string;
  content: string;           // 文字内容
  images: string[];          // 图片 base64 或路径
  tags: string[];            // 多个 Tag
  status: 'pending' | 'in_progress' | 'completed';
  plannedStartTime?: Date;   // 计划开始时间
  plannedEndTime?: Date;     // 计划结束时间
  actualStartTime?: Date;    // 实际开始时间
  actualEndTime?: Date;      // 实际结束时间
  review?: {
    achievement: 'below' | 'met' | 'exceeded';
    details: string;
  };
  createdAt: Date;
  updatedAt: Date;
}
```

## 页面结构

1. **主页**：时间线展示 + 筛选器 + 新建记录入口
2. **记录详情页**：查看/编辑单条记录
3. **复盘页**：月度复盘汇总
